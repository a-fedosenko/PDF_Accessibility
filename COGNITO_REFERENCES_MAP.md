# Cognito References Map - Complete Asset Inventory

## Document Containing Cognito References

### 1. _AWS_RESOURCES.md

#### Section: Security & Identity (Lines 145-217)

##### User Pool Configuration
- **Line 201**: User Pool ID: `us-east-2_HJtK36MHO`
- **Line 202**: User Pool Name: Auto-generated by CDK
- **Line 203**: App Client ID: `7s84oe77h699j77oc6m8cbvogt`
- **Line 204**: User Pool Domain: `pdf-ui-auth1rc16k`
- **Lines 212-217**: User Pool Features list (email auth, MFA, etc.)

##### IAM Roles
- **Line 158**: Cognito Authenticated Role ARN reference
- **Line 159**: Cognito Unauthenticated Role ARN reference

##### Identity Pool
- **Line 208**: Identity Pool ID: `us-east-2:c0f78434-f184-465f-8adb-ff2675227da2`
- **Line 210**: Authentication Providers reference

##### Frontend Configuration
- **Lines 403-408**: Environment Variables section
  - `REACT_APP_USER_POOL_ID`
  - `REACT_APP_USER_POOL_CLIENT_ID`
  - `REACT_APP_IDENTITY_POOL_ID`

##### API Gateway & Cognito
- **Line 425**: "Cognito authorizer" mentioned

##### Quick Reference
- **Line 698**: User Pool ARN reference
- **Line 699**: Identity Pool ARN reference
- **Line 708**: Cognito Domain URL

### 2. _DEPLOYMENT_SUMMARY.md

#### Section: Backend API & Authentication (Lines 45-59)

- **Line 50**: User Pool ID: `us-east-2_HJtK36MHO`
- **Line 51**: User Pool Client ID: `7s84oe77h699j77oc6m8cbvogt`
- **Line 52**: User Pool Domain: `pdf-ui-auth1rc16k`
- **Line 53**: Identity Pool ID: `us-east-2:c0f78434-f184-465f-8adb-ff2675227da2`
- **Line 54**: Authenticated Role ARN reference

#### Section: Cognito User Pool (Lines 212-217 in AWS_RESOURCES)
- Email-based authentication
- Email verification required
- Password complexity requirements
- MFA optional
- User attributes: email, name, custom fields

### 3. cleanup.sh

#### Resource Cleanup References
- **Line 36**: "Cognito User Pools" in resource list
- **Line 367**: Manual verification note for Cognito User Pool ID
  - References: `us-east-2_HJtK36MHO`

### 4. cdk.json

#### CDK Context Configuration
- **Line 43**: `@aws-cdk/aws-apigateway:authorizerChangeDeploymentLogicalId`
  - Purpose: Enables proper deployment of API Gateway authorizers

### 5. .env (Not in Repository)

#### Expected Environment Variables
```
REACT_APP_USER_POOL_ID=us-east-2_HJtK36MHO
REACT_APP_USER_POOL_CLIENT_ID=7s84oe77h699j77oc6m8cbvogt
REACT_APP_IDENTITY_POOL_ID=us-east-2:c0f78434-f184-465f-8adb-ff2675227da2
REACT_APP_UPDATE_FIRST_SIGN_IN_ENDPOINT=https://6597iy1nhi.execute-api.us-east-2.amazonaws.com/prod/update-first-sign-in
REACT_APP_CHECK_UPLOAD_QUOTA_ENDPOINT=https://6597iy1nhi.execute-api.us-east-2.amazonaws.com/prod/upload-quota
REACT_APP_UPDATE_ATTRIBUTES_API_ENDPOINT=https://6597iy1nhi.execute-api.us-east-2.amazonaws.com/prod/
```

---

## Code Files - No Cognito Code Found

### Analyzed Files

1. **app.py** (464 lines)
   - Main CDK application
   - Status: No Cognito imports or references
   - Reason: Cognito managed by separate CdkBackendStack

2. **pdf2html/cdk/lib/pdf2html-stack.js** (125 lines)
   - PDF-to-HTML Lambda CDK definition
   - Status: No Cognito references
   - Focus: Lambda, S3, IAM roles (not authentication)

3. **cdk/cdk_stack.py** (20 lines)
   - Placeholder CDK stack
   - Status: Empty/minimal
   - No Cognito references

4. **Lambda Functions**
   - `lambda/split_pdf/main.py`
   - `lambda/add_title/myapp.py`
   - `lambda/accessibility_checker_before_remidiation/main.py`
   - `lambda/accessability_checker_after_remidiation/main.py`
   - Status: No Cognito code
   - These are internal processing functions

---

## Assets Requiring Update for IdentityServer4

### Direct Replacements Needed

| Current Value | Type | Location | Frequency |
|---------------|------|----------|-----------|
| us-east-2_HJtK36MHO | User Pool ID | 3 files | 3 occurrences |
| 7s84oe77h699j77oc6m8cbvogt | App Client ID | 2 files | 2 occurrences |
| us-east-2:c0f78434-f184-465f-8adb-ff2675227da2 | Identity Pool ID | 2 files | 2 occurrences |
| pdf-ui-auth1rc16k | Domain | 2 files | 2 occurrences |

### Configuration Updates Needed

| Configuration | Action | Location |
|---------------|--------|----------|
| OIDC Authority URL | Update | Environment variables |
| OIDC Client ID | Update | Environment variables |
| OIDC Scope Claims | Update | Frontend config |
| API Authorizer Type | Change | API Gateway |
| IAM Trust Relationships | Update | Identity Pool config |

---

## Missing Implementations

### Not Found in Codebase

1. **Token Validation Lambda**
   - Location: Should be `lambda/authorizer/index.py`
   - Status: Not implemented
   - Need: JWT validation with IdentityServer4 keys

2. **Explicit Cognito Authorization**
   - Location: API Gateway configuration
   - Status: Implied in CDK, not explicit
   - Need: Lambda authorizer implementation

3. **Token Refresh Logic**
   - Location: Frontend application (external)
   - Status: Not visible in backend code
   - Need: Frontend implementation

4. **Cognito Event Handlers**
   - Location: Should be in Lambda
   - Status: Not implemented
   - Need: User sign-up, post-confirmation hooks

---

## Infrastructure Deployment Order

```
1. AWS CloudFormation (infrastructure-as-code)
   |
   ├─ PDFAccessibility Stack (PDF-to-PDF processing)
   |  ├─ S3 Bucket
   |  ├─ Lambda Functions (split, merge, etc.)
   |  ├─ ECS Cluster
   |  ├─ Step Functions State Machine
   |  └─ CloudWatch Resources
   |
   └─ CdkBackendStack (Optional - for UI)
      ├─ Cognito User Pool (us-east-2_HJtK36MHO)
      ├─ Cognito Identity Pool (us-east-2:c0f78434...)
      ├─ API Gateway
      ├─ Lambda Functions (API handlers)
      └─ IAM Roles (Authenticated/Unauthenticated)
```

---

## URLs & Endpoints

### Cognito Endpoints
- **Issuer**: https://cognito-idp.us-east-2.amazonaws.com/us-east-2_HJtK36MHO
- **Authorization**: https://pdf-ui-auth1rc16k.auth.us-east-2.amazoncognito.com/authorize
- **Token**: https://pdf-ui-auth1rc16k.auth.us-east-2.amazoncognito.com/oauth2/token
- **User Info**: https://pdf-ui-auth1rc16k.auth.us-east-2.amazoncognito.com/oauth2/userInfo
- **JWKS**: https://cognito-idp.us-east-2.amazonaws.com/us-east-2_HJtK36MHO/.well-known/jwks.json

### API Gateway Endpoints
- **Base**: https://6597iy1nhi.execute-api.us-east-2.amazonaws.com/prod/
- **Update First Sign-In**: /update-first-sign-in (POST)
- **Upload Quota**: /upload-quota (GET)
- **Update Attributes**: / (POST)

---

## Security Credentials Found

### In Repository
- Adobe API Client ID: `32cc479d5d89416f923ae7e38721d05d` (.env file)
- Adobe API Client Secret: (in .env, not shown in outputs)

### In AWS Console
- AWS Access Key ID: AKIAW3QUBM5IHQIPW7XL (.env file)
- AWS Account ID: 471414695760 (multiple files)

### Recommendations
- Rotate all credentials immediately
- Use AWS Secrets Manager for all sensitive data
- Implement credential rotation policy
- Enable MFA for console access

---

## CDK Stack Hierarchy

```
CdkBackendStack (Contains Cognito)
├── CdkBackendStack-CognitoDefaultAuthenticatedRole-*
│   └── Permissions for authenticated users
├── CdkBackendStack-CognitoDefaultUnauthenticatedRole-*
│   └── Limited permissions for unauthenticated users
├── Cognito User Pool: us-east-2_HJtK36MHO
│   ├── App Client: 7s84oe77h699j77oc6m8cbvogt
│   └── Domain: pdf-ui-auth1rc16k
└── Cognito Identity Pool: us-east-2:c0f78434-f184-465f-8adb-ff2675227da2
    ├── Authenticated Role
    ├── Unauthenticated Role
    └── Trust Relationship: Cognito User Pool
```

---

## Impact Analysis by File

### High Impact (Core Infrastructure)
- `_AWS_RESOURCES.md` - Documentation of infrastructure
- `_DEPLOYMENT_SUMMARY.md` - Deployment tracking and reference
- `app.py` - (doesn't contain Cognito, but CDK manages it)

### Medium Impact (Operations)
- `cleanup.sh` - Resource cleanup procedures
- `cdk.json` - CDK configuration

### Low Impact (No Direct Cognito Code)
- `pdf2html/cdk/lib/pdf2html-stack.js` - Separate service
- `cdk/cdk_stack.py` - Placeholder
- Lambda functions - Process internal logic

---

## Testing Validation Points

After IdentityServer4 integration:

1. Verify all 9 hardcoded references updated
2. Confirm API Gateway authorizer working
3. Validate token validation in Lambda
4. Test user login/logout flows
5. Check cleanup script updated
6. Verify documentation accuracy
7. Confirm environment variables set
8. Test API endpoints with new tokens

---

**Document Version**: 1.0
**Created**: November 17, 2025
**Last Updated**: November 17, 2025
**Status**: Complete Reference Map
